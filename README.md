# cellector
statistical model for finding anomalous genotype cells in mixed genotype scRNAseq data

Singularity build here: https://drive.google.com/file/d/1J4zKOCv666HBQgZbO6FK8LqYaIg59nHp/view?usp=sharing

From cellranger outputs (bam, cell barcodes.tsv) you can use `cellector_pipeline.py` with the following usage:

```bash
./cellector_pipeline.py -h
usage: cellector_pipeline.py [-h] -i BAM -b BARCODES -f FASTA -t THREADS -o OUT_DIR --common_variants COMMON_VARIANTS
                             [--min_alt MIN_ALT] [--min_ref MIN_REF] [--ignore IGNORE] [--cellector_binary CELLECTOR_BINARY]
                             [--souporcell_binary SOUPORCELL_BINARY]

single cell RNAseq foreign genotype cell detection

optional arguments:
  -h, --help            show this help message and exit
  -i BAM, --bam BAM     cellranger bam
  -b BARCODES, --barcodes BARCODES
                        barcodes.tsv from cellranger
  -f FASTA, --fasta FASTA
                        reference fasta file
  -t THREADS, --threads THREADS
                        max threads to use
  -o OUT_DIR, --out_dir OUT_DIR
                        name of directory to place cellector files
  --common_variants COMMON_VARIANTS
                        common variant loci or known variant loci vcf, must be vs same reference fasta
  --min_alt MIN_ALT     min alt to use locus, default = 4.
  --min_ref MIN_REF     min ref to use locus, default = 4.
  --ignore IGNORE       set to True to ignore data error assertions
  --cellector_binary CELLECTOR_BINARY
                        /path/to/cellector
  --souporcell_binary SOUPORCELL_BINARY
                        /path/to/souporcell
```

If you have the `alt.mtx` and `ref.mtx`, you can use `cellector_linux` directly with the following usage.

static binary for linux x64/x86 included in main directory  
python version is now deprecated

```bash
usage: ./cellector_linux -h
cellector 1.0.0
Haynes Heaton <whheaton@gmail.com>
genotype outlier detection for scRNAseq

USAGE:
    cellector [OPTIONS] --alt <alt> --ref <ref> --barcodes <barcodes> --output_directory <output_directory>

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

OPTIONS:
    -r, --ref <ref>                           ref.mtx matrix from vartrix
    -a, --alt <alt>                           alt.mtx matrix from vartrix
    -v, --vcf <vcf>                           associated VCF file (optional)
    -b, --barcodes <barcodes>                 cell barcodes
    -g, --ground_truth <ground_truth>         optional ground truth labels
    --interquartile_range_multiple <num>      IQR multiplier threshold
    --min_alleles_posterior <num>             minimum alleles for posterior step
    --min_alt <num>                           minimum alt cells (default 4)
    --min_ref <num>                           minimum ref cells (default 4)
    --output_directory <directory>            directory for output files
    --posterior_threshold <num>               posterior probability threshold (default 0.999)
```

---

## Minimal Test Dataset

A small test dataset is provided in the `test_data/` directory so users can quickly verify that
`cellector_linux` is functioning correctly using the standalone executable, without requiring any full Cell Ranger outputs.

### Included Files

```
test_data/
    alt.mtx
    ref.mtx
    barcodes.tsv
```

These matrices are intentionally tiny and are only meant to confirm that the binary runs successfully.

---

### Running the Minimal Example

To run `cellector_linux` on the provided minimal test dataset, you may use either the generic template or the exact example command below.

#### Generic Command Template

```bash
/path/to/cellector_linux \
    --alt /path/to/alt.mtx \
    --ref /path/to/ref.mtx \
    --barcodes /path/to/barcodes.tsv \
    --output_directory /path/to/output_dir
```

#### Example Command (using this repositoryâ€™s `test_data/`)

```bash
./cellector_linux \
    --alt test_data/alt.mtx \
    --ref test_data/ref.mtx \
    --barcodes test_data/barcodes.tsv \
    --output_directory example_output
```

This will create:

```
example_output/
```

containing the output files generated by cellector.

